<!DOCTYPE html>
<html lang="et">
<head>
  <meta charset="UTF-8" />
  <title>Itaalia keel ‚Äì S√µnavara ja test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <!-- PWA & iOS asjad -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="IT √µppe√§pp" />
  <meta name="theme-color" content="#ffffff" />

  <link rel="apple-touch-icon" href="icon-192.png" />
  <link rel="manifest" href="manifest.json" />

  <style>
    /* Itaalia lipu taust: roheline - valge - punane vertikaalribad */
    html, body {
      height: 100%;
      margin: 0;
    }
    body {
      background: linear-gradient(
        to right,
        #009246 0%,   #009246 33%,
        #ffffff 33%,  #ffffff 66%,
        #ce2b37 66%,  #ce2b37 100%
      );
      font-family: Arial, sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .app {
      background: rgba(255, 255, 255, 0.96);
      max-width: 900px;
      width: 100%;
      margin: 0 auto;
      padding: 20px 24px;
      border: 1px solid #ccc;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.15);
    }

    h1, h2, h3, h4 {
      text-align: center;
    }
    #main-nav {
      text-align: center;
      margin-bottom: 20px;
    }
    button {
      padding: 10px 16px;
      margin: 6px 4px;
      border-radius: 8px;
      border: 1px solid #333;
      background-color: #f0f0f0;
      cursor: pointer;
    }
    button:hover {
      background-color: #e0e0e0;
    }
    #main-nav button {
      min-width: 140px;
    }
    .vocab-block {
      margin-top: 24px;
    }
    .vocab-block h3 {
      margin-bottom: 8px;
    }
    .vocab-block h4 {
      margin-top: 12px;
      margin-bottom: 4px;
      text-align: left;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: left;
    }
    th {
      background-color: #f0f0f0;
    }
    /* Testi osa stiilid */
    #quiz-area {
      margin-top: 20px;
    }
    #estonian-word {
      font-size: 1.4em;
      font-weight: bold;
      margin: 16px 0;
      text-align: center;
    }
    #answer-input {
      width: 100%;
      padding: 8px;
      font-size: 1.1em;
      margin-top: 4px;
      box-sizing: border-box;
    }
    #feedback {
      margin-top: 12px;
      font-weight: bold;
    }
    #top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }
    #top-bar-title {
      flex: 1;
      text-align: center;
      font-weight: bold;
    }
    .correct-row {
      background-color: #d4edda; /* √µige ‚Äì hele roheline */
    }
    .wrong-row {
      background-color: #f8d7da; /* vale ‚Äì hele punane */
    }
    #last-result {
      margin-top: 20px;
    }
    .list-note {
      font-size: 14px;
      color: #555;
      margin-top: 6px;
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>Itaalia keel ‚Äì s√µnavara ja test</h1>

    <!-- √úLEMINE VALIK: S√µnavara vs Test -->
    <div id="main-nav">
      <button id="btn-vocab" type="button">S√µnavara</button>
      <button id="btn-quiz" type="button">Testi oskuseid</button>
    </div>

    <!-- S√ïNAVARA OSA -->
    <div id="vocab-area" style="display:none;">
      <h2>S√µnavara</h2>

      <div id="vocab-buttons" style="text-align:center; margin-bottom:10px;">
        <button id="vocab-numbers-btn">Numbrid</button>
        <button id="vocab-days-btn">P√§evad, kuud ja suunad</button>
        <button id="vocab-body-btn">Kehaosad</button>
        <button id="vocab-back-btn">Tagasi</button>
      </div>
      <div id="vocab-note" class="list-note">
        Vali √ºks kategooria, et n√§ha selle s√µnu, mida hetkel saab kontrollida.
      </div>
      <div id="vocab-list"></div>
    </div>

    <!-- TESTI OSA -->
    <div id="quiz-section" style="display:none;">

      <!-- Blokivalik testimiseks -->
      <div id="mode-select">
        <h2>Testi oskuseid</h2>
        <p style="text-align:center;">Vali blokk, mida harjutada:</p>
        <div style="text-align:center;">
          <button id="mode-body">Kehaosad</button>
          <button id="mode-numbers">Numbrid</button>
          <button id="mode-days">P√§evad, kuud ja suunad</button>
        </div>
      </div>

      <!-- P√§ris testimine -->
      <div id="quiz-area" style="display:none;">
        <div id="top-bar">
          <button id="restart-btn">Kokkuv√µte</button>
          <div id="top-bar-title"><span id="mode-title"></span></div>
          <button id="cancel-btn">Katkesta</button>
        </div>

        <p id="instructions"></p>

        <div id="estonian-word">Vajuta ‚ÄûJ√§rgmine‚Äù</div>

        <label for="answer-input">
          Sinu vastus itaalia keeles:
        </label>
        <input type="text" id="answer-input" autocomplete="off" />

        <div>
          <button id="voice-btn" type="button">üé§ √útle vastus</button>
          <span id="speech-status"></span>
        </div>

        <br />

        <button id="check-btn">Kontrolli</button>
        <button id="next-btn">J√§rgmine</button>

        <div id="feedback"></div>

        <div id="last-result"></div>
      </div>

      <!-- Testi kokkuv√µte -->
      <div id="summary"></div>
    </div>
  </div>

  <script>
    // ---------- ITAALIA NUMBRID ABIFUNKTSIOON ----------
    function italianNumber(n) {
      n = Number(n);
      if (!Number.isInteger(n) || n <= 0 || n > 9999) return String(n);

      const units = ["", "uno", "due", "tre", "quattro", "cinque", "sei", "sette", "otto", "nove"];
      const teens = {
        10: "dieci", 11: "undici", 12: "dodici", 13: "tredici", 14: "quattordici", 15: "quindici",
        16: "sedici", 17: "diciassette", 18: "diciotto", 19: "diciannove"
      };
      const tensWords = {
        2: "venti",
        3: "trenta",
        4: "quaranta",
        5: "cinquanta",
        6: "sessanta",
        7: "settanta",
        8: "ottanta",
        9: "novanta"
      };
      const hundredsWords = {
        1: "cento",
        2: "duecento",
        3: "trecento",
        4: "quattrocento",
        5: "cinquecento",
        6: "seicento",
        7: "settecento",
        8: "ottocento",
        9: "novecento"
      };

      if (n <= 9) return units[n];
      if (n >= 10 && n < 20) return teens[n];

      if (n < 100) {
        const t = Math.floor(n / 10);
        const u = n % 10;
        let tensWord = tensWords[t];
        if (u === 1 || u === 8) {
          tensWord = tensWord.slice(0, -1);
        }
        return u === 0 ? tensWord : tensWord + units[u];
      }

      if (n === 100) return "cento";
      if (n < 200) return "cento" + italianNumber(n - 100);

      if (n < 1000) {
        const h = Math.floor(n / 100);
        const r = n % 100;
        let prefix = hundredsWords[h];
        if (r >= 80 && r < 90) {
          prefix = prefix.replace(/o$/, "");
        }
        return r === 0 ? prefix : prefix + italianNumber(r);
      }

      if (n === 1000) return "mille";
      if (n < 2000) return "mille" + (n === 1000 ? "" : italianNumber(n - 1000));

      const thousands = Math.floor(n / 1000);
      const rem = n % 1000;
      const thousandsPart = italianNumber(thousands) + "mila";
      return rem === 0 ? thousandsPart : thousandsPart + italianNumber(rem);
    }

    // ---------- S√ïNAVARA ANDMED ----------

    const vocabWeekdays = [
      { et: "esmasp√§ev", it: "luned√¨" },
      { et: "teisip√§ev", it: "marted√¨" },
      { et: "kolmap√§ev", it: "mercoled√¨" },
      { et: "neljap√§ev", it: "gioved√¨" },
      { et: "reede", it: "venerd√¨" },
      { et: "laup√§ev", it: "sabato" },
      { et: "p√ºhap√§ev", it: "domenica" }
    ];

    const vocabMonths = [
      { et: "jaanuar", it: "gennaio" },
      { et: "veebruar", it: "febbraio" },
      { et: "m√§rts", it: "marzo" },
      { et: "aprill", it: "aprile" },
      { et: "mai", it: "maggio" },
      { et: "juuni", it: "giugno" },
      { et: "juuli", it: "luglio" },
      { et: "august", it: "agosto" },
      { et: "september", it: "settembre" },
      { et: "oktoober", it: "ottobre" },
      { et: "november", it: "novembre" },
      { et: "detsember", it: "dicembre" }
    ];

    const vocabDirections = [
      { et: "p√µhi", it: "nord" },
      { et: "l√µuna", it: "sud" },
      { et: "ida", it: "est" },
      { et: "l√§√§s", it: "ovest" },
      { et: "√ºles", it: "su" },
      { et: "alla", it: "gi√π" },
      { et: "vasakule", it: "a sinistra" },
      { et: "paremale", it: "a destra" },
      { et: "edasi", it: "avanti" },
      { et: "tagasi", it: "indietro" }
    ];

    const vocabBody = [
      { et: "juuksed", it: "i capelli" },
      { et: "otsmik", it: "la fronte" },
      { et: "kulm", it: "il sopracciglio" },
      { et: "kulmud", it: "le sopracciglia" },
      { et: "ripsmed", it: "le ciglia" },
      { et: "silm", it: "l'occhio" },
      { et: "silmad", it: "gli occhi" },
      { et: "nina", it: "il naso" },
      { et: "p√µsk", it: "la guancia" },
      { et: "p√µsed", it: "le guance" },
      { et: "suu", it: "la bocca" },
      { et: "huuled", it: "le labbra" },
      { et: "hammas", it: "il dente" },
      { et: "hambad", it: "i denti" },
      { et: "keel", it: "la lingua" },
      { et: "l√µug", it: "il mento" },
      { et: "kael", it: "il collo" },
      { et: "√µlg", it: "la spalla" },
      { et: "√µlad", it: "le spalle" },
      { et: "rindkere", it: "il petto" },
      { et: "selg", it: "la schiena" },
      { et: "k√µht", it: "la pancia" },
      { et: "meeste suguelund", it: "il pene" },
      { et: "naiste suguelund", it: "la vagina" },
      { et: "puus", it: "il fianco" },
      { et: "k√§si (√µlast randmeni)", it: "il braccio" },
      { et: "k√§si (randmest allpool)", it: "la mano" },
      { et: "s√µrm", it: "il dito" },
      { et: "s√µrmed", it: "le dita" },
      { et: "tagumik", it: "il sedere" },
      { et: "jalg", it: "la gamba" },
      { et: "p√µlv", it: "il ginocchio" },
      { et: "p√∂id (jalg)", it: "il piede" },
      { et: "varvas", it: "il dito del piede" }
    ];

    // ---------- TESTI ANDMED ----------

    const bodyWords = [
      { et: "pea", it: ["testa", "la testa"] },
      { et: "silm", it: ["occhio", "l'occhio"] },
      { et: "nina", it: ["naso", "il naso"] },
      { et: "suu", it: ["bocca", "la bocca"] },
      { et: "hammas", it: ["dente", "il dente"] },
      { et: "keel", it: ["lingua", "la lingua"] },
      { et: "k√µrv", it: ["orecchio", "l'orecchio"] },
      { et: "kael", it: ["collo", "il collo"] },
      { et: "√µlg", it: ["spalla", "la spalla"] },
      { et: "k√§si (randmest allpool)", it: ["mano", "la mano"] },
      { et: "s√µrm", it: ["dito", "il dito"] },
      { et: "rind", it: ["petto", "il petto", "torace", "il torace"] },
      { et: "selg", it: ["schiena", "la schiena"] },
      { et: "k√µht", it: ["pancia", "la pancia", "stomaco", "lo stomaco"] },
      { et: "jalg", it: ["gamba", "la gamba"] },
      { et: "p√µlv", it: ["ginocchio", "il ginocchio"] },
      { et: "varvas", it: ["dito del piede", "il dito del piede"] },
      { et: "tagumik", it: ["sedere", "il sedere", "natiche", "le natiche", "glutei"] },
      { et: "naeratus", it: ["sorriso", "il sorriso"] },
      { et: "ripsmed", it: ["ciglia", "le ciglia"] },
      { et: "huuled", it: ["labbra", "le labbra"] },
      { et: "p√µsk", it: ["guancia", "la guancia"] },
      { et: "p√µsed", it: ["guance", "le guance"] },
      { et: "kulm", it: ["sopracciglio", "il sopracciglio"] },
      { et: "kulmud", it: ["sopracciglia", "le sopracciglia"] },
      { et: "meeste suguelund", it: ["pene", "il pene", "pisello"] },
      { et: "naiste suguelund", it: ["vagina", "la vagina", "vulva", "la vulva"] }
    ];

    const daysMonthsDirs = [
      { et: "esmasp√§ev", it: ["luned√¨", "lunedi", "il luned√¨", "il lunedi"] },
      { et: "teisip√§ev", it: ["marted√¨", "martedi", "il marted√¨", "il martedi"] },
      { et: "kolmap√§ev", it: ["mercoled√¨", "mercoledi", "il mercoled√¨", "il mercoledi"] },
      { et: "neljap√§ev", it: ["gioved√¨", "giovedi", "il gioved√¨", "il giovedi"] },
      { et: "reede", it: ["venerd√¨", "venerdi", "il venerd√¨", "il venerdi"] },
      { et: "laup√§ev", it: ["sabato", "il sabato"] },
      { et: "p√ºhap√§ev", it: ["domenica", "la domenica"] },

      { et: "jaanuar", it: ["gennaio", "il mese di gennaio"] },
      { et: "veebruar", it: ["febbraio", "il mese di febbraio"] },
      { et: "m√§rts", it: ["marzo", "il mese di marzo"] },
      { et: "aprill", it: ["aprile", "il mese di aprile"] },
      { et: "mai", it: ["maggio", "il mese di maggio"] },
      { et: "juuni", it: ["giugno", "il mese di giugno"] },
      { et: "juuli", it: ["luglio", "il mese di luglio"] },
      { et: "august", it: ["agosto", "il mese di agosto"] },
      { et: "september", it: ["settembre", "il mese di settembre"] },
      { et: "oktoober", it: ["ottobre", "il mese di ottobre"] },
      { et: "november", it: ["novembre", "il mese di novembre"] },
      { et: "detsember", it: ["dicembre", "il mese di dicembre"] },

      { et: "p√µhi", it: ["nord", "il nord"] },
      { et: "l√µuna", it: ["sud", "il sud"] },
      { et: "ida", it: ["est", "l'est"] },
      { et: "l√§√§s", it: ["ovest", "l'ovest"] },

      { et: "√ºles", it: ["su", "verso l'alto"] },
      { et: "alla", it: ["gi√π", "verso il basso"] },
      { et: "vasakule", it: ["a sinistra", "sinistra"] },
      { et: "paremale", it: ["a destra", "destra"] },
      { et: "edasi", it: ["avanti", "dritto", "vai avanti"] },
      { et: "tagasi", it: ["indietro", "torna indietro"] }
    ];

    function buildNumberWords() {
      const pool = [];
      for (let i = 1; i <= 100; i++) pool.push(i);
      for (let i = 1; i <= 9; i++) pool.push(i * 100);
      for (let i = 1; i <= 9; i++) pool.push(i * 1000);

      const shuffled = pool.sort(function () { return Math.random() - 0.5; });
      const selected = shuffled.slice(0, 10);

      return selected.map(function (n) {
        const word = italianNumber(n);
        return {
          et: String(n),
          it: [word, String(n)]
        };
      });
    }

    // ---------- TESTI MUUTUJAD ----------

    let currentWords = [];
    let currentWord = null;
    let usedIndices = [];
    let results = [];
    let currentMode = null;
    let lastResult = null;
    const MAX_QUESTIONS = 15;
    let questionLimit = 0;
    let recognition = null;
    let speechSupported = false;

    // ---------- ABI FUNKTSIOONID ----------

    function normalize(str) {
      return String(str || "")
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .trim();
    }

    function speak(text, lang) {
      if (!("speechSynthesis" in window)) return;
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = lang;
      window.speechSynthesis.speak(utterance);
    }

    function initSpeechRecognition() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) return;

      recognition = new SpeechRecognition();
      recognition.lang = "it-IT";
      recognition.interimResults = false;

      recognition.onresult = function (event) {
        if (!event.results || !event.results[0] || !event.results[0][0]) return;
        const transcript = event.results[0][0].transcript;
        answerInput.value = transcript;
        document.getElementById("speech-status").textContent = `Kuuldud: "${transcript}"`;
      };

      recognition.onerror = function (event) {
        document.getElementById("speech-status").textContent =
          "H√§√§letuvastus eba√µnnestus: " + event.error;
      };

      recognition.onend = function () {
        voiceBtn.disabled = false;
      };

      speechSupported = true;
    }

    function startVoiceInput() {
      if (!speechSupported || !recognition) return;
      document.getElementById("speech-status").textContent = "Kuulan ...";
      voiceBtn.disabled = true;
      recognition.start();
    }

    function showModeSelect() {
      document.getElementById("mode-select").style.display = "block";
      document.getElementById("quiz-area").style.display = "none";
    }

    function renderLastResult() {
      const div = document.getElementById("last-result");
      if (!lastResult) {
        div.innerHTML = "";
        return;
      }
      const rowClass = lastResult.ok ? "correct-row" : "wrong-row";
      let html = "<h3>Eelmine k√ºsimus</h3>";
      html += '<table><tr><th>Eesti</th><th>Sinu vastus</th><th>√ïige(d)</th></tr>';
      html += `<tr class="${rowClass}">
                 <td>${lastResult.et}</td>
                 <td>${lastResult.user}</td>
                 <td>${lastResult.correct}</td>
               </tr>`;
      html += "</table>";
      div.innerHTML = html;
    }

    function startMode(mode) {
      currentMode = mode;
      usedIndices = [];
      results = [];
      lastResult = null;
      currentWord = null;
      document.getElementById("feedback").textContent = "";
      document.getElementById("answer-input").value = "";
      document.getElementById("summary").innerHTML = "";
      renderLastResult();
      questionLimit = 0;

      document.getElementById("speech-status").textContent = speechSupported
        ? "Saad kirjutamise asemel ka h√§√§lega vastata."
        : "H√§√§letuvastus ei ole selles brauseris toetatud.";
      voiceBtn.disabled = !speechSupported;

      if (mode === "body") {
        currentWords = bodyWords.slice();
        document.getElementById("mode-title").textContent = "Kehaosad";
        document.getElementById("instructions").textContent =
          "Kuvatakse kehaosa eesti keeles. Kirjuta itaaliakeelne vastus (v√µid kasutada ka h√§√§lsisestust).";
      } else if (mode === "numbers") {
        currentWords = buildNumberWords();
        document.getElementById("mode-title").textContent = "Numbrid";
        document.getElementById("instructions").textContent =
          "K√ºsitakse juhuslikke numbreid (1‚Äì100, sajad, tuhanded). V√µid vastata itaalia s√µnaga v√µi lihtsalt numbriga.";
      } else if (mode === "days") {
        currentWords = daysMonthsDirs.slice();
        document.getElementById("mode-title").textContent = "P√§evad, kuud ja suunad";
        document.getElementById("instructions").textContent =
          "K√ºsitakse n√§dalap√§evi, 12 kuud, ilmakaari ja suundi (√ºles, alla, vasakule, paremale, edasi, tagasi). Kirjuta itaaliakeelne vastus.";
      }

      questionLimit = Math.min(MAX_QUESTIONS, currentWords.length);

      document.getElementById("mode-select").style.display = "none";
      document.getElementById("quiz-area").style.display = "block";

      pickNewWord();
    }

    function pickNewWord() {
      if (!currentWords.length) return;

      if (usedIndices.length >= questionLimit ||
          usedIndices.length === currentWords.length) {
        showSummary();
        return;
      }

      let index;
      do {
        index = Math.floor(Math.random() * currentWords.length);
      } while (usedIndices.includes(index));

      usedIndices.push(index);
      currentWord = currentWords[index];

      document.getElementById("estonian-word").textContent = currentWord.et;
      document.getElementById("answer-input").value = "";
      document.getElementById("feedback").textContent = "";
      document.getElementById("answer-input").focus();
      document.getElementById("speech-status").textContent = speechSupported
        ? "Saad vajutada ‚Äû√útle vastus‚Äù ja vastata h√§√§lega."
        : "H√§√§letuvastus ei ole selles brauseris toetatud.";
    }

    function checkAnswer() {
      if (!currentWord) return;

      const inputRaw = document.getElementById("answer-input").value;
      const input = normalize(inputRaw);
      if (!input) {
        document.getElementById("feedback").textContent =
          "Kirjuta palun vastus enne kontrollimist.";
        return;
      }

      const correctNormalized = currentWord.it.map(normalize);
      const isCorrect = correctNormalized.includes(input);
      const feedback = document.getElementById("feedback");
      const correctText = currentWord.it.join(", ");

      const row = {
        et: currentWord.et,
        user: inputRaw,
        correct: correctText,
        ok: isCorrect
      };

      results.push(row);
      lastResult = row;
      renderLastResult();

      if (isCorrect) {
        feedback.textContent = "√ïIGE! ‚úÖ ‚Äì " + correctText;
      } else {
        feedback.textContent = "‚ùå Vale. √ïige(d): " + correctText;
      }

      speak(currentWord.it[0], "it-IT");

      if (results.length >= questionLimit) {
        feedback.textContent += " Maksimum 15 k√ºsimust on t√§is ‚Äì kuvan kokkuv√µtte.";
        setTimeout(showSummary, 500);
      }
    }

    function renderSummary() {
      const summaryDiv = document.getElementById("summary");
      summaryDiv.innerHTML = "";

      if (!results.length) {
        summaryDiv.innerHTML = "<h2>Kokkuv√µte</h2><p>√úhtegi vastust ei j√µudnud anda.</p>";
        return;
      }

      const correctCount = results.filter(r => r.ok).length;
      let html = "<h2>Kokkuv√µte</h2>" +
        "<p>√ïigeid vastuseid: " + correctCount + " / " + results.length + "</p>";

      html += "<table><tr><th>Eesti s√µna / number</th><th>Sinu vastus</th><th>√ïige(d)</th></tr>";

      results.forEach(function (row) {
        const rowClass = row.ok ? "correct-row" : "wrong-row";
        html += '<tr class="' + rowClass + '">';
        html += "<td>" + row.et + "</td>";
        html += "<td>" + row.user + "</td>";
        html += "<td>" + row.correct + "</td>";
        html += "</tr>";
      });

      html += "</table>";
      summaryDiv.innerHTML = html;
    }

    function showSummary() {
      renderSummary();
      showModeSelect();
    }

    // ---------- PEAVAATE / NAV FUNKTSIOONID ----------

    const btnVocab = document.getElementById("btn-vocab");
    const btnQuiz = document.getElementById("btn-quiz");
    const vocabArea = document.getElementById("vocab-area");
    const quizSection = document.getElementById("quiz-section");

    function showInitial() {
      vocabArea.style.display = "none";
      quizSection.style.display = "none";
    }

    function showVocab() {
      vocabArea.style.display = "block";
      quizSection.style.display = "none";
      document.getElementById("vocab-note").textContent =
        "Vali √ºks kategooria, et n√§ha selle s√µnu, mida hetkel saab kontrollida.";
      document.getElementById("vocab-list").innerHTML = "";
    }

    function showQuiz() {
      vocabArea.style.display = "none";
      quizSection.style.display = "block";
      showModeSelect();
    }

    btnVocab.onclick = showVocab;
    btnQuiz.onclick = showQuiz;

    // ---------- S√ïNAVARA BLOKKIDE NUPUD ----------

    const vocabNumbersBtn = document.getElementById("vocab-numbers-btn");
    const vocabDaysBtn = document.getElementById("vocab-days-btn");
    const vocabBodyBtn = document.getElementById("vocab-body-btn");
    const vocabBackBtn = document.getElementById("vocab-back-btn");

    function showVocabCategory(category) {
      const listDiv = document.getElementById("vocab-list");
      let html = "";

      if (category === "numbers") {
        html += "<div class='vocab-block'>";
        html += "<h3>Numbrid</h3>";
        html += "<p style='text-align:center;'>1‚Äì20, seej√§rel 20, 25, 30, 35, 40, k√ºmnelised kuni 100 ning sajad kuni 1000.</p>";
        html += "<table><thead><tr><th>Eesti (number)</th><th>Itaalia (s√µnana)</th></tr></thead><tbody>";

        const order = [];
        const added = new Set();
        function addNumber(n) {
          if (!added.has(n)) {
            added.add(n);
            order.push(n);
          }
        }
        for (let i = 1; i <= 20; i++) addNumber(i);
        [20, 25, 30, 35, 40].forEach(addNumber);
        for (let i = 10; i <= 100; i += 10) addNumber(i);
        for (let i = 100; i <= 1000; i += 100) addNumber(i);

        order.forEach(function (n) {
          html += "<tr><td>" + n + "</td><td>" + italianNumber(n) + "</td></tr>";
        });

        html += "</tbody></table></div>";
      } else if (category === "days") {
        html += "<div class='vocab-block'>";
        html += "<h3>P√§evad, kuud ja suunad</h3>";

        html += "<h4>N√§dalap√§evad (E‚ÄìP)</h4>";
        html += "<table><thead><tr><th>Eesti</th><th>Itaalia</th></tr></thead><tbody>";
        vocabWeekdays.forEach(function (item) {
          html += "<tr><td>" + item.et + "</td><td>" + item.it + "</td></tr>";
        });
        html += "</tbody></table>";

        html += "<h4>Kuud (Jaanuar ‚Äì Detsember)</h4>";
        html += "<table><thead><tr><th>Eesti</th><th>Itaalia</th></tr></thead><tbody>";
        vocabMonths.forEach(function (item) {
          html += "<tr><td>" + item.et + "</td><td>" + item.it + "</td></tr>";
        });
        html += "</tbody></table>";

        html += "<h4>Suunad ja liikumine</h4>";
        html += "<table><thead><tr><th>Eesti</th><th>Itaalia</th></tr></thead><tbody>";
        vocabDirections.forEach(function (item) {
          html += "<tr><td>" + item.et + "</td><td>" + item.it + "</td></tr>";
        });
        html += "</tbody></table>";

        html += "</div>";
      } else if (category === "body") {
        html += "<div class='vocab-block'>";
        html += "<h3>Kehaosad (juustest varvasteni)</h3>";
        html += "<table><thead><tr><th>Eesti</th><th>Itaalia</th></tr></thead><tbody>";
        vocabBody.forEach(function (item) {
          html += "<tr><td>" + item.et + "</td><td>" + item.it + "</td></tr>";
        });
        html += "</tbody></table></div>";
      }

      listDiv.innerHTML = html;
    }

    vocabNumbersBtn.onclick = function () { showVocabCategory("numbers"); };
    vocabDaysBtn.onclick = function () { showVocabCategory("days"); };
    vocabBodyBtn.onclick = function () { showVocabCategory("body"); };
    vocabBackBtn.onclick = function () { showInitial(); };

    // ---------- NUPUD TESTI JAOKS ----------

    const modeBodyBtn = document.getElementById("mode-body");
    const modeNumbersBtn = document.getElementById("mode-numbers");
    const modeDaysBtn = document.getElementById("mode-days");
    const nextBtn = document.getElementById("next-btn");
    const checkBtn = document.getElementById("check-btn");
    const restartBtn = document.getElementById("restart-btn");
    const cancelBtn = document.getElementById("cancel-btn");
    const answerInput = document.getElementById("answer-input");
    const voiceBtn = document.getElementById("voice-btn");
    const speechStatus = document.getElementById("speech-status");

    modeBodyBtn.onclick = function () { startMode("body"); };
    modeNumbersBtn.onclick = function () { startMode("numbers"); };
    modeDaysBtn.onclick = function () { startMode("days"); };
    nextBtn.onclick = function () { pickNewWord(); };
    checkBtn.onclick = function () { checkAnswer(); };
    restartBtn.onclick = function () { showSummary(); };
    cancelBtn.onclick = function () { showSummary(); };
    voiceBtn.onclick = function () { startVoiceInput(); };

    answerInput.addEventListener("keydown", function (e) {
      if (e.key === "Enter") {
        checkAnswer();
      }
    });

    // ---------- INIT ----------

    initSpeechRecognition();
    if (!speechSupported) {
      speechStatus.textContent = "H√§√§letuvastus ei ole selles brauseris toetatud.";
      if (voiceBtn) voiceBtn.disabled = true;
    } else {
      speechStatus.textContent = "Saad vajutada ‚Äû√útle vastus‚Äù ja r√§√§kida itaalia keeles.";
    }

    // algseis ‚Äì ainult √ºlemine valik (S√µnavara / Testi oskuseid)
    showInitial();

    if ("serviceWorker" in navigator) {
      window.addEventListener("load", function () {
        navigator.serviceWorker
          .register("service-worker.js")
          .catch(function (e) { console.error(e); });
      });
    }
  </script>
</body>
</html>
